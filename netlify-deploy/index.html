<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nauti-Bouys D-ID Agent Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for D-ID agent */
        #did-agent-container {
            min-height: 500px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        /* Ensure agent fills container */
        #did-agent-container > * {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-8">
        <div class="max-w-6xl mx-auto px-4">
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <!-- Header -->
                <div class="bg-gradient-to-r from-teal-600 to-blue-600 px-8 py-6">
                    <h1 class="text-3xl font-bold text-white">Nauti-Bouys AI Assistant</h1>
                    <p class="text-teal-100 mt-2">Your Maritime AI Assistant powered by D-ID</p>
                </div>

                <!-- Agent Status -->
                <div class="px-8 py-4 bg-gray-50 border-b">
                    <div class="flex items-center space-x-4">
                        <div id="agent-status" class="flex items-center">
                            <div class="animate-pulse w-3 h-3 bg-yellow-400 rounded-full mr-2"></div>
                            <span class="text-sm font-medium text-gray-600">Loading AI Assistant...</span>
                        </div>
                        <div class="text-xs text-gray-500">
                            Agent ID: v2_agt_AYiJdoSm
                        </div>
                    </div>
                </div>

                <!-- D-ID Agent Container -->
                <div class="px-8 py-6">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Chat with Your Maritime AI Assistant</h2>
                    
                    <!-- Agent Container -->
                    <div class="bg-gradient-to-br from-teal-50 to-blue-50 rounded-lg p-6 shadow-inner">
                        <div 
                            id="did-agent-container" 
                            class="w-full bg-white rounded-lg shadow-lg border-2 border-teal-200"
                        >
                            <!-- D-ID Agent will load here -->
                            <div class="flex items-center justify-center h-96">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600 mx-auto mb-4"></div>
                                    <p class="text-gray-600 font-medium">Initializing your AI assistant...</p>
                                    <p class="text-gray-500 text-sm mt-2">This may take a moment</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Usage Instructions -->
                <div class="px-8 py-6 bg-gray-50">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">üéØ How to Use Your Maritime AI Assistant</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h4 class="font-semibold text-teal-700 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a2 2 0 012-2h2a2 2 0 012 2v6a3 3 0 01-3 3z"></path>
                                </svg>
                                Voice Interaction
                            </h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ Click the microphone button to start voice chat</li>
                                <li>‚Ä¢ Allow microphone access when prompted</li>
                                <li>‚Ä¢ Speak naturally about cocktails, wines, or spirits</li>
                                <li>‚Ä¢ Watch the avatar respond with realistic lip-sync</li>
                            </ul>
                        </div>

                        <div class="bg-white p-4 rounded-lg shadow">
                            <h4 class="font-semibold text-teal-700 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                Text Chat
                            </h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ Use the text input for typed questions</li>
                                <li>‚Ä¢ Ask about menu items, recommendations, or reservations</li>
                                <li>‚Ä¢ Get expert advice on wine and spirit pairings</li>
                                <li>‚Ä¢ Learn about Nauti-Bouys unique offerings</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Sample Questions -->
                    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-3">üó£Ô∏è Try These Sample Questions:</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                            <div>
                                <h5 class="font-medium text-blue-700 mb-2">üçπ Cocktails</h5>
                                <ul class="text-blue-600 space-y-1">
                                    <li>"What's your signature maritime cocktail?"</li>
                                    <li>"Recommend a rum-based drink"</li>
                                    <li>"What cocktails pair with seafood?"</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-medium text-blue-700 mb-2">ü•É Spirits & Wines</h5>
                                <ul class="text-blue-600 space-y-1">
                                    <li>"Show me your premium bourbon selection"</li>
                                    <li>"What wines complement oysters?"</li>
                                    <li>"Tell me about your whiskey collection"</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-medium text-blue-700 mb-2">üìÖ Services</h5>
                                <ul class="text-blue-600 space-y-1">
                                    <li>"I'd like to make a reservation"</li>
                                    <li>"What are your waterfront seating options?"</li>
                                    <li>"Do you offer private dining?"</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technical Status -->
                <div class="px-8 py-4 bg-gray-100 border-t">
                    <details>
                        <summary class="cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900">
                            üîß Technical Information & Debug Console
                        </summary>
                        <div class="mt-4 space-y-2">
                            <div class="grid grid-cols-2 gap-4 text-xs">
                                <div>
                                    <strong>Agent Configuration:</strong>
                                    <div class="mt-1 font-mono bg-gray-200 p-2 rounded">
                                        Agent ID: v2_agt_AYiJdoSm<br>
                                        Mode: full<br>
                                        Monitor: enabled<br>
                                        SDK: agent.d-id.com/v2
                                    </div>
                                </div>
                                <div>
                                    <strong>Status Log:</strong>
                                    <div id="debug-log" class="mt-1 font-mono bg-gray-200 p-2 rounded h-24 overflow-y-auto text-xs">
                                        Initializing D-ID Agent SDK...<br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </div>
    </div>

    <!-- D-ID Agent SDK Script -->
    <script type="module"
        src="https://agent.d-id.com/v2/index.js"
        data-mode="full"
        data-client-key="Z29vZ2xlLW9hdXRoMnwxMDcyODc2NjczODk5NDc0ODU0NDU6VVIxdU9IS1NPWVBUVnBmbUo5NXRo"
        data-agent-id="v2_agt_AYiJdoSm"
        data-name="did-agent"
        data-monitor="true"
        data-target-id="did-agent-container">
    </script>

    <script>
        // Debug logging
        function log(message) {
            const debugLog = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[D-ID Agent] ${message}`);
        }

        // Status indicators
        function updateStatus(status, color = 'yellow') {
            const statusEl = document.getElementById('agent-status');
            const colors = {
                yellow: 'bg-yellow-400',
                green: 'bg-green-400',
                red: 'bg-red-400'
            };
            
            statusEl.innerHTML = `
                <div class="w-3 h-3 ${colors[color]} rounded-full mr-2"></div>
                <span class="text-sm font-medium text-gray-600">${status}</span>
            `;
        }

        // Listen for agent events
        window.addEventListener('message', function(event) {
            if (event.origin.includes('d-id.com')) {
                log(`Message from agent: ${JSON.stringify(event.data)}`);
                
                // Handle different event types
                switch (event.data?.type) {
                    case 'agent-ready':
                        updateStatus('AI Assistant Ready', 'green');
                        log('Agent is ready for interaction');
                        break;
                    case 'agent-error':
                        updateStatus('Connection Error', 'red');
                        log(`Agent error: ${event.data.message}`);
                        break;
                    case 'conversation-start':
                        updateStatus('Conversation Active', 'green');
                        log('Conversation started');
                        break;
                    case 'conversation-end':
                        updateStatus('AI Assistant Ready', 'green');
                        log('Conversation ended');
                        break;
                }
            }
        });

        // Enhanced SDK load detection
        window.addEventListener('load', function() {
            log('Page loaded, initializing D-ID Agent SDK...');
            log('Target container ID: did-agent-container');
            log('Current URL: ' + window.location.href);
            
            // Check if container exists
            const container = document.getElementById('did-agent-container');
            if (!container) {
                log('ERROR: Target container not found!');
                updateStatus('Container Error', 'red');
                return;
            }
            
            // Monitor SDK loading
            let checkCount = 0;
            const maxChecks = 30; // 30 seconds
            
            const checkSDKLoad = () => {
                checkCount++;
                const container = document.getElementById('did-agent-container');
                
                log(`SDK Load Check ${checkCount}/${maxChecks}`);
                
                // Check if D-ID has added content to container
                if (container.children.length > 1) {
                    updateStatus('AI Assistant Ready', 'green');
                    log('‚úÖ D-ID SDK loaded successfully!');
                    return;
                }
                
                // Check for iframe or other D-ID elements
                if (container.querySelector('iframe') || container.querySelector('[data-did]')) {
                    updateStatus('AI Assistant Loading...', 'yellow');
                    log('üîÑ D-ID elements detected, still loading...');
                }
                
                if (checkCount < maxChecks) {
                    setTimeout(checkSDKLoad, 1000);
                } else {
                    updateStatus('Load Failed - Check Console', 'red');
                    log('‚ùå SDK failed to load after 30 seconds');
                    log('Container children count: ' + container.children.length);
                    log('Container innerHTML: ' + container.innerHTML.substring(0, 200));
                }
            };
            
            // Start checking after 2 seconds
            setTimeout(checkSDKLoad, 2000);
        });

        // Enhanced error handling
        window.addEventListener('error', function(event) {
            log(`‚ùå JavaScript error: ${event.message}`);
            log(`Error source: ${event.filename}:${event.lineno}`);
            if (event.message.includes('d-id') || event.message.includes('agent')) {
                updateStatus('D-ID Script Error', 'red');
            } else {
                updateStatus('Script Error', 'red');
            }
        });
        
        // Network error detection
        window.addEventListener('unhandledrejection', function(event) {
            log(`‚ùå Network/Promise error: ${event.reason}`);
            if (event.reason.toString().includes('d-id') || event.reason.toString().includes('agent')) {
                updateStatus('D-ID Network Error', 'red');
            }
        });

        // Enhanced console info and diagnostics
        console.log('=== Nauti-Bouys D-ID Agent SDK Test ===');
        console.log('üéØ Agent ID:', 'v2_agt_AYiJdoSm');
        console.log('üîë Client Key:', 'Z29vZ2xlLW9hdXRoMnwxMDcyODc2NjczODk5NDc0ODU0NDU6VVIxdU9IS1NPWVBUVnBmbUo5NXRo');
        console.log('üìç Target Container:', 'did-agent-container');
        console.log('üìú SDK URL:', 'https://agent.d-id.com/v2/index.js');
        console.log('üåê Current Domain:', window.location.origin);
        console.log('üì± User Agent:', navigator.userAgent);
        
        // Test SDK URL accessibility
        fetch('https://agent.d-id.com/v2/index.js')
            .then(response => {
                log(`‚úÖ SDK URL accessible (Status: ${response.status})`);
            })
            .catch(error => {
                log(`‚ùå SDK URL not accessible: ${error.message}`);
                updateStatus('SDK Not Accessible', 'red');
            });
            
        // Domain validation
        log(`üîç Checking if domain ${window.location.origin} is whitelisted in D-ID...`);
        
        // Container validation
        setTimeout(() => {
            const container = document.getElementById('did-agent-container');
            if (container) {
                log(`‚úÖ Target container found: ${container.tagName}`);
                log(`üìê Container dimensions: ${container.offsetWidth}x${container.offsetHeight}`);
            } else {
                log(`‚ùå Target container 'did-agent-container' not found!`);
            }
        }, 1000);
    </script>
</body>
</html>